<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
	<title>Sensor</title>
</head>

<body style="text-align:center">
    <div style="width: 95%;margin:auto">
        <canvas id="canvas" height="450" width="800"></canvas>
    </div>
    Limit to recent <input id="num" type="text" maxlength="2" size="2" value="15"/>items
    <button onclick="query()">ok</button>

<script src="__ROOT__/statics/js/jquery.js"></script>
<script src="/thinkcmfx1.5.0/tpl/simplebootx/Sensor/Chart.min.js"></script>
<script>
var randomScalingFactor = function(){ return Math.round(Math.random()*100)};

function query(){
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");
    context.clearRect(0, 0, canvas.width, canvas.height);
        var phpdata;
        $(function() {
            var num=$("#num").val();
            $.getJSON("http://104.131.150.53/api/query.php?sn=75&num="+num+"&callback=?",
            //$.getJSON("/clatfd/1/api/query.php?sn=75&num="+num+"&callback=?",
				function (phpdata){

                    //phpdata=JSON.parse(r);
                    //data[0].values.push(phpdata);
                    var barChartData = {
                        labels :phpdata['time'],
                        datasets : [
                            {
                                fillColor : "rgba(220,220,220,0.5)",
                                strokeColor : "rgba(220,220,220,0.8)",
                                highlightFill: "rgba(220,220,220,0.75)",
                                highlightStroke: "rgba(220,220,220,1)",
                                data : phpdata['data']
                            }
                        ]

                    }

                    var ctx = document.getElementById("canvas").getContext("2d");
                    window.myBar = new Chart(ctx).Bar(barChartData, {
                        responsive : true
                    });
                }
			);	
			});

}   
query();
</script>

</body>
</html>